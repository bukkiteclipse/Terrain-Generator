using UnityEngine;
using System.Collections;

public class PerlinNoise2D {
    
    // Improved PerlinNoise Algorithm
    readonly int[] NOISE_TABLE = 
        { 151,160,137,91,90,15,
        131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,
        190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,
        88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,
        77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,
        102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,
        135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,
        5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,
        223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,
        129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,
        251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,
        49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,
        138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180
    };

    public float Noise(float x, float z)
    {
        
        //int xi = (int) Mathf.FloorToInt(x) & 255;
        //int zi = (int) Mathf.FloorToInt(z) & 255;
        
        int xi = (int)Mathf.FloorToInt(x) & 1023;
        int zi = (int)Mathf.FloorToInt(z) & 1023;
        // ALL 4 corner gradientVectors


        int gradient1 = NOISE_TABLE2[NOISE_TABLE2[xi] + zi];
        int gradient2 = NOISE_TABLE2[NOISE_TABLE2[xi + 1] + zi];
        int gradient3 = NOISE_TABLE2[NOISE_TABLE2[xi] + zi + 1];
        int gradient4 = NOISE_TABLE2[NOISE_TABLE2[xi + 1] + zi +1];
        


        float xf = x - Mathf.FloorToInt(x);
        float zf = z - Mathf.FloorToInt(z);

        // VerbindungsVectoren
        float f1 = Grad(gradient1, xf, zf);
        float f2 = Grad(gradient2, xf - 1, zf);
        float f3 = Grad(gradient3, xf, zf - 1);
        float f4 = Grad(gradient4, xf - 1, zf - 1);

        float u = Fade(xf);
        float v = Fade(zf);

        float x1Interpolation = Lerp(u, f1, f2);
        float x2Interpolation = Lerp(u, f3, f4);
        float zInterpolation = Lerp(v, x1Interpolation, x2Interpolation);

        return zInterpolation;
    }

    float Lerp(float amount, float left, float right)
    {
        return ((1 - amount) * left + amount * right);
    }

    float Fade(float t)
    {
        // FadeFunction 6t^5 - 15t^4 + 10t^3
        return t * t * t * (t * (t * 6 - 15) + 10);
    }

    // 4 Base gradientVectors for improved Implementation
    float Grad(int hash, float x, float z)
    {
        switch(hash & 3)
        {
            case 0: return x + z;
            case 1: return -x + z;
            case 2: return x + -z;
            case 3: return -x + -z;
            default: return 0;
        }
    }

    readonly int[] NOISE_TABLE2 =
    {
        209, 107, 265, 631, 261, 674, 768, 430, 140, 97, 447, 84, 28, 996, 730, 11, 719, 983, 208, 446, 280, 417, 665, 611, 461, 801, 993, 568, 370, 912, 440, 108, 510, 724, 442, 306, 103, 963, 615, 941, 197, 161, 681, 81, 516, 425, 174, 788, 747, 890, 180, 821, 953, 766, 934, 101, 394, 427, 875, 690, 900, 0, 780, 1017, 254, 174, 35, 618, 974, 268, 163, 58, 626, 860, 124, 202, 771, 207, 398, 844, 399, 58, 506, 582, 776, 857, 290, 618, 241, 652, 657, 481, 404, 810, 864, 848, 243, 500, 753, 490, 904, 640, 639, 322, 347, 314, 95, 219, 605, 16, 982, 12, 900, 512, 256, 862, 950, 864, 377, 123, 927, 23, 609, 348, 38, 510, 727, 716, 142,
        29, 773, 279, 844, 957, 957, 101, 764, 548, 229, 56, 77, 299, 508, 891, 320, 527, 926, 977, 709, 131, 797, 1001, 671, 94, 568, 314, 319, 577, 99, 464, 388, 791, 317, 708, 845, 911, 125, 864, 317, 901, 790, 60, 598, 448, 821, 71, 213, 641, 359, 35, 287, 788, 115, 569, 415, 498, 839, 923, 823, 486, 227, 764, 259, 838, 306, 1018, 594, 146, 926, 379, 546, 900, 114, 500, 156, 303, 278, 75, 235, 707, 237, 854, 41, 353, 176, 274, 296, 416, 286, 316, 146, 878, 846, 337, 295, 129, 260, 455, 198, 719, 552, 503, 132, 323, 500, 301, 53, 881, 575, 59, 176, 276, 526, 822, 860, 980, 454, 810, 464, 300, 809, 768, 209, 835, 469, 613, 881,
        526, 539, 12, 210, 599, 942, 891, 450, 536, 30, 131, 642, 249, 506, 87, 210, 257, 302, 427, 726, 525, 835, 562, 110, 783, 826, 124, 583, 535, 6, 395, 55, 927, 749, 327, 877, 739, 947, 128, 124, 974, 1011, 617, 386, 909, 230, 531, 368, 738, 901, 767, 750, 259, 568, 455, 852, 823, 269, 903, 243, 64, 503, 5, 799, 850, 451, 866, 631, 109, 16, 189, 65, 994, 264, 827, 293, 42, 662, 711, 274, 86, 95, 304, 208, 541, 544, 857, 128, 189, 717, 196, 590, 530, 100, 554, 145, 167, 126, 386, 969, 207, 88, 920, 586, 957, 128, 73, 420, 470, 58, 856, 156, 450, 867, 58, 8, 848, 705, 795, 209, 169, 663, 307, 550, 323, 473, 410, 41,
        133, 348, 719, 332, 610, 576, 910, 812, 500, 277, 995, 727, 393, 68, 236, 68, 204, 984, 870, 289, 61, 787, 497, 61, 428, 260, 184, 112, 833, 214, 105, 51, 562, 189, 581, 526, 919, 766, 676, 395, 130, 28, 616, 134, 770, 778, 654, 390, 986, 232, 918, 306, 78, 295, 91, 775, 221, 167, 431, 30, 146, 754, 329, 539, 338, 1000, 896, 87, 920, 436, 978, 468, 8, 907, 82, 960, 677, 109, 994, 538, 652, 743, 658, 632, 467, 778, 612, 1011, 884, 664, 372, 754, 306, 259, 185, 994, 228, 207, 136, 190, 993, 722, 368, 751, 9, 252, 322, 304, 91, 640, 208, 1001, 830, 409, 855, 490, 542, 167, 142, 889, 397, 1014, 496, 597, 494, 62, 819, 661,
        829, 728, 159, 572, 738, 124, 163, 1012, 37, 437, 14, 116, 878, 295, 559, 514, 384, 884, 864, 458, 672, 691, 444, 1021, 479, 110, 43, 301, 706, 100, 90, 450, 775, 155, 15, 838, 917, 1006, 459, 736, 602, 937, 977, 111, 868, 709, 885, 653, 405, 486, 247, 321, 776, 652, 550, 772, 636, 445, 979, 688, 565, 735, 801, 1002, 318, 686, 244, 987, 547, 994, 496, 76, 573, 897, 496, 157, 477, 472, 355, 452, 241, 667, 638, 238, 94, 800, 832, 871, 652, 55, 971, 567, 442, 747, 769, 1019, 44, 869, 267, 161, 379, 1012, 301, 30, 314, 927, 305, 876, 369, 930, 432, 484, 947, 452, 705, 126, 287, 724, 167, 137, 267, 77, 955, 26, 774, 700, 540, 960,
        870, 923, 129, 754, 498, 265, 544, 835, 974, 35, 447, 400, 397, 975, 953, 36, 806, 341, 575, 321, 606, 613, 531, 651, 138, 271, 664, 893, 626, 414, 115, 857, 203, 115, 442, 502, 221, 689, 596, 607, 966, 1008, 574, 597, 846, 282, 556, 683, 314, 338, 376, 446, 477, 208, 575, 900, 995, 949, 566, 298, 600, 802, 14, 431, 639, 545, 549, 185, 308, 399, 945, 391, 895, 688, 467, 248, 865, 751, 437, 896, 262, 270, 59, 583, 301, 54, 730, 434, 1022, 31, 976, 869, 878, 826, 553, 489, 486, 938, 4, 315, 295, 700, 741, 241, 538, 990, 820, 759, 220, 17, 174, 136, 62, 374, 497, 656, 455, 961, 367, 689, 651, 606, 409, 702, 547, 869, 357, 483,
        935, 943, 316, 136, 193, 44, 725, 685, 196, 707, 180, 877, 288, 579, 967, 113, 440, 77, 748, 69, 560, 649, 342, 946, 448, 314, 327, 1005, 255, 208, 239, 413, 163, 558, 800, 975, 388, 532, 264, 344, 234, 898, 336, 864, 177, 744, 952, 175, 225, 125, 693, 667, 12, 890, 673, 684, 275, 432, 929, 670, 1020, 894, 178, 952, 1014, 840, 830, 627, 772, 335, 790, 977, 893, 282, 700, 795, 279, 169, 1001, 107, 578, 848, 852, 744, 837, 567, 520, 147, 763, 896, 268, 333, 229, 617, 640, 743, 497, 773, 303, 290, 131, 707, 272, 495, 296, 105, 111, 127, 952, 540, 547, 124, 245, 701, 418, 567, 545, 258, 467, 142, 938, 684, 789, 536, 179, 171, 69, 97,
        25, 539, 352, 490, 917, 965, 243, 565, 915, 53, 946, 603, 440, 360, 829, 91, 296, 171, 662, 991, 612, 923, 973, 42, 205, 510, 772, 149, 492, 930, 813, 861, 549, 946, 224, 333, 948, 893, 786, 136, 927, 561, 173, 194, 210, 234, 198, 24, 921, 820, 396, 277, 873, 814, 45, 144, 581, 655, 355, 166, 1017, 530, 981, 385, 1015, 41, 560, 89, 738, 337, 899, 483, 158, 252, 113, 603, 314, 217, 947, 845, 528, 492, 922, 386, 319, 817, 387, 186, 1000, 74, 655, 591, 909, 79, 887, 90, 157, 218, 782, 953, 837, 64, 140, 268, 150, 814, 9, 699, 117, 492, 14, 277, 223, 38, 985, 216, 204, 841, 423, 168, 58, 882, 66, 650, 1017, 349, 536, 975,
        588, 226, 830, 971, 455, 850, 530, 74, 381, 855, 130, 439, 313, 256, 418, 259, 349, 56, 175, 361, 225, 565, 932, 406, 48, 808, 34, 285, 399, 281, 435, 408, 862, 737, 95, 441, 427, 755, 514, 25, 882, 263, 1023, 955, 75, 954, 423, 273, 357, 961, 547, 952, 94, 429, 679, 814, 997, 236, 847, 878, 253, 860, 615, 435, 77, 965, 689, 391, 306, 864, 451, 737, 1021, 723, 959, 797, 600, 559, 366, 156, 977, 237, 293, 787, 332, 841, 490, 449, 94, 295, 749, 90, 935, 32, 933, 982, 691, 651, 742, 303, 822, 7, 158, 423, 591, 345, 815, 628, 726, 393, 531, 84, 506, 186, 987, 803, 251, 615, 418, 375, 579, 173, 435, 262, 267, 165, 605, 490,
        325, 260, 239, 177, 452, 1006, 815, 455, 118, 834, 1010, 1003, 990, 936, 291, 819, 560, 574, 753, 645, 286, 782, 237, 650, 413, 835, 631, 696, 279, 408, 40, 887, 208, 411, 964, 809, 445, 791, 975, 931, 422, 592, 757, 409, 779, 973, 593, 114, 828, 748, 996, 604, 489, 469, 187, 629, 661, 802, 956, 428, 904, 564, 889, 546, 566, 540, 570, 232, 878, 231, 5, 607, 363, 345, 630, 721, 855, 57, 537, 637, 219, 985, 78, 743, 301, 199, 961, 560, 813, 385, 64, 230, 76, 108, 198, 798, 366, 885, 197, 642, 52, 904, 749, 144, 1006, 849, 274, 637, 1013, 215, 377, 744, 313, 1022, 565, 280, 631, 327, 866, 349, 512, 20, 132, 775, 214, 523, 186, 414,
        380, 638, 79, 233, 274, 81, 171, 501, 811, 847, 469, 622, 52, 734, 658, 872, 883, 897, 345, 295, 41, 760, 413, 642, 510, 916, 351, 39, 643, 733, 860, 594, 369, 445, 512, 641, 595, 296, 723, 554, 308, 401, 324, 949, 86, 375, 607, 960, 781, 1018, 380, 549, 413, 928, 1016, 62, 811, 838, 904, 164, 499, 978, 67, 979, 615, 42, 10, 304, 36, 747, 476, 92, 877, 385, 876, 1012, 879, 865, 858, 191, 120, 436, 437, 662, 572, 10, 881, 893, 87, 380, 37, 250, 870, 802, 955, 29, 640, 245, 890, 379, 50, 208, 902, 1, 710, 187, 747, 950, 578, 408, 303, 45, 645, 501, 185, 514, 414, 499, 360, 682, 482, 283, 595, 665, 27, 373, 248, 774,
        224, 77, 769, 659, 72, 207, 588, 651, 249, 784, 260, 452, 801, 761, 358, 455, 234, 580, 553, 908, 167, 741, 399, 491, 369, 33, 443, 438, 171, 6, 323, 429, 685, 288, 708, 880, 491, 259, 463, 542, 713, 910, 678, 887, 709, 230, 273, 301, 954, 171, 225, 389, 932, 38, 209, 80, 691, 813, 533, 38, 103, 968, 33, 756, 264, 999, 295, 229, 758, 528, 66, 324, 830, 640, 635, 528, 558, 237, 888, 223, 999, 254, 576, 517, 359, 916, 326, 521, 279, 507, 960, 299, 438, 396, 137, 241, 15, 610, 155, 176, 825, 651, 220, 929, 991, 122, 1013, 269, 384, 874, 455, 555, 185, 799, 637, 121, 868, 400, 796, 925, 655, 244, 327, 595, 879, 805, 776, 871,
        725, 102, 619, 407, 789, 859, 831, 940, 503, 601, 859, 381, 989, 816, 955, 547, 591, 581, 490, 65, 719, 994, 644, 542, 841, 938, 496, 322, 826, 396, 244, 826, 101, 412, 649, 117, 792, 288, 998, 351, 198, 583, 728, 594, 71, 554, 333, 921, 282, 318, 842, 60, 698, 411, 673, 94, 621, 100, 330, 656, 231, 8, 151, 738, 439, 73, 89, 598, 157, 663, 406, 497, 203, 453, 131, 445, 890, 771, 355, 521, 606, 949, 793, 869, 815, 1023, 372, 292, 986, 158, 954, 410, 724, 83, 604, 991, 181, 273, 131, 903, 870, 1, 967, 134, 1014, 173, 368, 893, 711, 969, 377, 407, 424, 122, 987, 611, 335, 99, 200, 607, 740, 654, 8, 344, 832, 953, 765, 309,
        51, 958, 954, 941, 58, 900, 531, 999, 749, 310, 445, 55, 1014, 405, 592, 1023, 849, 193, 871, 541, 111, 793, 33, 352, 527, 942, 490, 560, 688, 324, 685, 728, 238, 260, 652, 730, 130, 662, 162, 312, 835, 250, 414, 456, 543, 298, 412, 654, 1017, 110, 310, 853, 51, 851, 934, 10, 976, 59, 403, 205, 840, 224, 330, 550, 903, 324, 560, 930, 742, 93, 408, 937, 698, 765, 873, 159, 905, 163, 173, 274, 261, 852, 431, 824, 942, 4, 18, 778, 67, 960, 64, 501, 297, 890, 900, 862, 900, 86, 593, 559, 235, 277, 897, 304, 892, 687, 675, 526, 133, 525, 33, 468, 536, 894, 628, 242, 382, 459, 927, 264, 1007, 660, 453, 859, 972, 46, 272, 15,
        840, 584, 989, 89, 399, 630, 190, 57, 347, 1011, 17, 926, 846, 791, 141, 648, 917, 113, 946, 72, 232, 467, 1008, 740, 897, 101, 792, 374, 100, 611, 977, 657, 275, 296, 206, 693, 228, 281, 1011, 608, 11, 34, 705, 872, 228, 431, 46, 583, 537, 884, 614, 298, 1012, 443, 259, 226, 133, 955, 480, 597, 309, 248, 5, 633, 256, 967, 253, 690, 179, 732, 371, 32, 611, 18, 534, 360, 745, 427, 400, 128, 763, 210, 949, 71, 655, 122, 286, 227, 809, 635, 260, 374, 501, 612, 374, 527, 0, 382, 1002, 423, 528, 585, 430, 399, 663, 795, 217, 467, 637, 876, 833, 241, 453, 547, 302, 165, 674, 69, 437, 413, 246, 880, 561, 153, 297, 476, 416, 194,
        981, 753, 907, 235, 1, 760, 156, 13, 884, 793, 324, 104, 30, 900, 125, 152, 691, 395, 545, 563, 306, 370, 352, 713, 143, 202, 111, 405, 639, 377, 743, 669, 20, 983, 24, 748, 787, 759, 556, 252, 672, 374, 526, 204, 132, 860, 726, 936, 560, 517, 484, 351, 124, 607, 706, 607, 620, 940, 937, 301, 557, 346, 187, 188, 32, 448, 219, 319, 506, 300, 947, 374, 982, 298, 121, 982, 636, 727, 232, 132, 340, 164, 804, 941, 789, 84, 120, 711, 666, 167, 317, 743, 335, 976, 203, 705, 547, 982, 504, 953, 817, 189, 594, 766, 291, 453, 865, 495, 454, 759, 512, 940, 864, 732, 51, 329, 2, 365, 518, 525, 883, 326, 389, 478, 834, 635, 305
    };


}
